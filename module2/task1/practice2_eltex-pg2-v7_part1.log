MYUSER=eltex-pg2-v7
echo ${MYUSER} eltex-pg2-v7
ssh-keygen
Generating public/private rsa key pair.
Enter file in which to save the key (/home/eltex-pg2-v7/.ssh/id_rsa):
Created directory '/home/eltex-pg2-v7/.ssh'.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/eltex-pg2-v7/.ssh/id_rsa
Your public key has been saved in /home/eltex-pg2-v7/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:x7pVtMqQpCCPn9ycIN5SGF7DPmZNJTMbHV5gQWl5cDU eltex-pg2-v7@eltex-2025-autumn
The key's randomart image is:
+---[RSA 3072]----+
|      =oOBo.E    |
|   .   X=o.  .   |
|  o = o.o.  .    |
| . O = o o . .   |
|  = O o S o o    |
| . O * . = o     |
|  o = + . +      |
|   .     o       |
|        .        |
+----[SHA256]-----+

ssh-copy-id root@172.16.9.207

/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/eltex-pg2-v7/.ssh/id_rsa.pub"
The authenticity of host '172.16.9.207 (172.16.9.207)' can't be established.
ED25519 key fingerprint is SHA256:YNVzj+RtetZfXv5XUn/CUjeEcaMD4eg3jy8EuGGIS+o.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:1: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@172.16.9.207's password:

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'root@172.16.9.207'"
and check to make sure that only the key(s) you wanted were added.

screen -S pract_2_1
Ctrl + a + A: practice_1
Ctrl-a + c
ssh root@172.16.9.207
Ctrl- a + A: practice_2
cd
cd ~/.ssh/
vi authorized_keys
Ctrl-a + n
cd 
cd ~/.ssh/
vi id_rsa.pub
Ctrl-a + n
Ключи одинаковые
ls -ls id_rsa.pub
4 -rw-r--r-- 1 eltex-pg2-v7 eltex-pg2-v7 584 Oct 15 19:23 id_rsa.pub

Ctrl-a + n

ls -l authorized_keys
-rw------- 1 root root 584 Oct 15 12:29 authorized_keys

useradd -m -s /bin/bash -p 1122334455667788  user1

useradd user2

useradd user3

lastlog
Username         Port     From                                       Latest
root             pts/0    172.16.8.4                                Wed Oct 15 12:33:35 +0000 2025
daemon                                                              **Never logged in**
bin                                                                 **Never logged in**
sys                                                                 **Never logged in**
sync                                                                **Never logged in**
games                                                               **Never logged in**
man                                                                 **Never logged in**
lp                                                                  **Never logged in**
mail                                                                **Never logged in**
news                                                                **Never logged in**
uucp                                                                **Never logged in**
proxy                                                               **Never logged in**
www-data                                                            **Never logged in**
backup                                                              **Never logged in**
list                                                                **Never logged in**
irc                                                                 **Never logged in**
_apt                                                                **Never logged in**
nobody                                                              **Never logged in**
systemd-network                                                     **Never logged in**
systemd-timesync                                                    **Never logged in**
dhcpcd                                                              **Never logged in**
messagebus                                                          **Never logged in**
systemd-resolve                                                     **Never logged in**
pollinate                                                           **Never logged in**
polkitd                                                             **Never logged in**
syslog                                                              **Never logged in**
uuidd                                                               **Never logged in**
tcpdump                                                             **Never logged in**
tss                                                                 **Never logged in**
landscape                                                           **Never logged in**
fwupd-refresh                                                       **Never logged in**
usbmux                                                              **Never logged in**
sshd                                                                **Never logged in**
tech                                                                **Never logged in**
Stas                                                                **Never logged in**
user1                                                               **Never logged in**
user2                                                               **Never logged in**
user3                                                               **Never logged in**

 usermod -s /usr/sbin/nologin user3

 su user3
This account is currently not available.

su -s /bin/bash user3
user3@eltex-practice2-pg2-v7:/root$

 su -s /bin/bash user3
user3@eltex-practice2-pg2-v7:/root$ ls
ls: cannot open directory '.': Permission denied
user3@eltex-practice2-pg2-v7:/root$ pwd
/root
user3@eltex-practice2-pg2-v7:/root$ cd
bash: cd: /home/user3: No such file or directory
user3@eltex-practice2-pg2-v7:/root$ logout
bash: logout: not login shell: use `exit'

exit
exit

 cat /etc/group | grep user_group
user_group:x:1005:

usermod -aG user_group user1
usermod -aG user_group user2
usermod -aG user_group user3

 id -Gn user1
user1 user_group
root@eltex-practice2-pg2-v7:~# id -Gn user2
user2 user_group
root@eltex-practice2-pg2-v7:~# id -Gn user3
user3 user_group

root@eltex-practice2-pg2-v7:~# mkdir /opt/share

root@eltex-practice2-pg2-v7:/opt# ls -l
total 4
drwxr-xr-x 2 root root 4096 Oct 15 13:27 share

root@eltex-practice2-pg2-v7:/opt# chgrp user_group share
root@eltex-practice2-pg2-v7:/opt# ls -l
total 4
drwxr-xr-x 2 root user_group 4096 Oct 15 13:27 share

root@eltex-practice2-pg2-v7:/opt# chmod 2775 share
root@eltex-practice2-pg2-v7:/opt# ls -ld share
drwxrwsr-x 2 root user_group 4096 Oct 15 13:27 share


user1@eltex-practice2-pg2-v7:~$ vi ~/.bashrc

Записать там в конце umask 0006

user1@eltex-practice2-pg2-v7:~$ umask
0006
user1@eltex-practice2-pg2-v7:~$ umask -S
u=rwx,g=rwx,o=x

user1@eltex-practice2-pg2-v7:~$ cd /opt/share/
user1@eltex-practice2-pg2-v7:/opt/share$ mkdir dir_user1
user1@eltex-practice2-pg2-v7:/opt/share$ ls
dir_user1

root@eltex-practice2-pg2-v7:~# su -s /bin/bash user3
user3@eltex-practice2-pg2-v7:/root$ whoami
user3
user3@eltex-practice2-pg2-v7:/root$ cd
bash: cd: /home/user3: No such file or directory
user3@eltex-practice2-pg2-v7:/root$ cd /opt/share/
user3@eltex-practice2-pg2-v7:/opt/share$ ls
dir_user1
user3@eltex-practice2-pg2-v7:/opt/share$ mkdir dir_user3
user3@eltex-practice2-pg2-v7:/opt/share$ ls
dir_user1  dir_user3

user2@eltex-practice2-pg2-v7:/opt/share$ mkdir dir_user2
user2@eltex-practice2-pg2-v7:/opt/share$ ls
dir_user1  dir_user2  dir_user3

user2@eltex-practice2-pg2-v7:/opt/share$ rmdir dir_user1
user2@eltex-practice2-pg2-v7:/opt/share$ ls
dir_user2  dir_user3
user2@eltex-practice2-pg2-v7:/opt/share$ rmdir dir_user3
user2@eltex-practice2-pg2-v7:/opt/share$ ls
dir_user2
user2@eltex-practice2-pg2-v7:/opt/share$ exit
exit
root@eltex-practice2-pg2-v7:~# su -s /bin/bash user3
user3@eltex-practice2-pg2-v7:/root$ cd /opt/share/
user3@eltex-practice2-pg2-v7:/opt/share$ ls
dir_user2
user3@eltex-practice2-pg2-v7:/opt/share$ rmdir dir_user2/
user3@eltex-practice2-pg2-v7:/opt/share$ ls
user3@eltex-practice2-pg2-v7:/opt/share$

root@eltex-practice2-pg2-v7:~# chmod +t /opt/share
root@eltex-practice2-pg2-v7:~# ls -l /opt/
total 4
drwxrwsr-t 2 root user_group 4096 Oct 17 12:40 share

root@eltex-practice2-pg2-v7:~# su user1
user1@eltex-practice2-pg2-v7:/root$ cd /opt/share/
user1@eltex-practice2-pg2-v7:/opt/share$ mkdir dir_user1
user1@eltex-practice2-pg2-v7:/opt/share$ exit
exit

root@eltex-practice2-pg2-v7:~# su -s /bin/bash  user2
user2@eltex-practice2-pg2-v7:/root$  mkdir /opt/share/dir_user2
user2@eltex-practice2-pg2-v7:/root$ exit
exit
root@eltex-practice2-pg2-v7:~# su -s /bin/bash  user3
user3@eltex-practice2-pg2-v7:/root$  mkdir /opt/share/dir_user3
user3@eltex-practice2-pg2-v7:/root$ ls -l /opt/share
total 12
drwxrws--x 2 user1 user_group 4096 Oct 17 12:45 dir_user1
drwxrwsr-x 2 user2 user_group 4096 Oct 17 12:46 dir_user2
drwxrwsr-x 2 user3 user_group 4096 Oct 17 12:47 dir_user3

user3@eltex-practice2-pg2-v7:/root$ rmdir /opt/share/dir_user1
rmdir: failed to remove '/opt/share/dir_user1': Operation not permitted
user3@eltex-practice2-pg2-v7:/root$ exit
exit
root@eltex-practice2-pg2-v7:~# su user1
user1@eltex-practice2-pg2-v7:/root$ rmdir /opt/share/dir_user2
rmdir: failed to remove '/opt/share/dir_user2': Operation not permitted
user1@eltex-practice2-pg2-v7:/root$ exit
exit
root@eltex-practice2-pg2-v7:~# su -s /bin/bash  user2
user2@eltex-practice2-pg2-v7:/root$ rmdir /opt/share/dir_user3
rmdir: failed to remove '/opt/share/dir_user3': Operation not permitted


root@eltex-practice2-pg2-v7:~# usermod -aG sudo user1
root@eltex-practice2-pg2-v7:~# su user1
user1@eltex-practice2-pg2-v7:/root$ sudo dmesg

[187317.710335] audit: type=1400 audit(1760702108.866:334): apparmor="DENIED" operation="mknod" class="file" profile="ubuntu_pro_esm_cache" name="/usr/lib/python3/dist-packages/uaclient/messages/__pycache__/__init__.cpython-312.pyc.135658842193200" pid=39808 comm="python3" requested_mask="c" denied_mask="c" fsuid=0 ouid=0
[187317.711143] audit: type=1400 audit(1760702108.867:335): apparmor="DENIED" operation="mknod" class="file" profile="ubuntu_pro_esm_cache" name="/usr/lib/python3/dist-packages/uaclient/messages/__pycache__/urls.cpython-312.pyc.135658842193200" pid=39808 comm="python3" requested_mask="c" denied_mask="c" fsuid=0 ouid=0

-------Не выполнено--------

root@eltex-practice2-pg2-v7:~# cd /opt/share/
root@eltex-practice2-pg2-v7:/opt/share# touch bash_script

root@eltex-practice2-pg2-v7:~# chmod u+s /opt/share/bash_script
root@eltex-practice2-pg2-v7:~# ls -l /opt/share/
total 16
-rwSr--r-- 1 root  user_group   35 Oct 17 13:20 bash_script
drwxrws--x 2 user1 user_group 4096 Oct 17 12:45 dir_user1
drwxrwsr-x 2 user2 user_group 4096 Oct 17 12:49 dir_user2
drwxrwsr-x 2 user3 user_group 4096 Oct 17 12:47 dir_user3

В файле bash_cript
#!bin/bash

dmesg

-----------Не выполнено----------

root@eltex-practice2-pg2-v7:~# chage -M 10 user1
root@eltex-practice2-pg2-v7:~# chage -M 10 user2
root@eltex-practice2-pg2-v7:~# chage -M 10 user3
root@eltex-practice2-pg2-v7:~# chage -l user1
Last password change                                    : Jan 11, 1970
Password expires                                        : Jan 21, 1970
Password inactive                                       : never
Account expires                                         : never
Minimum number of days between password change          : 0
Maximum number of days between password change          : 10
Number of days of warning before password expires       : 7
root@eltex-practice2-pg2-v7:~# chage -l user2
Last password change                                    : Jan 11, 1970
Password expires                                        : Jan 21, 1970
Password inactive                                       : never
Account expires                                         : never
Minimum number of days between password change          : 0
Maximum number of days between password change          : 10
Number of days of warning before password expires       : 7
root@eltex-practice2-pg2-v7:~# chage -l user3
Last password change                                    : Jan 16, 1970
Password expires                                        : Jan 26, 1970
Password inactive                                       : never
Account expires                                         : never
Minimum number of days between password change          : 0
Maximum number of days between password change          : 10
Number of days of warning before password expires       : 7


root@eltex-practice2-pg2-v7:~# vi /etc/motd

В файле:

Повелицин Станислав


root@eltex-practice2-pg2-v7:~# rsync -a /etc/ /root/etc_backup/

root@eltex-practice2-pg2-v7:~/etc_backup# tar -czf /root/etc_backup.tar.gz *
root@eltex-practice2-pg2-v7:~/etc_backup# tar -cjf /root/etc_backup.tar.bz2 *
root@eltex-practice2-pg2-v7:~/etc_backup# tar -cf - * | 7z a -si /root/etc_backup.tar.7z

7-Zip 23.01 (x64) : Copyright (c) 1999-2023 Igor Pavlov : 2023-06-20
 64-bit locale=en_US.UTF-8 Threads:2 OPEN_MAX:1024

Creating archive: /root/etc_backup.tar.7z

Add new data to archive: 1 file


Files read from disk: 1
Archive size: 486470 bytes (476 KiB)
Everything is Ok
root@eltex-practice2-pg2-v7:~# ls
etc_backup  etc_backup.tar.7z  etc_backup.tar.bz2  etc_backup.tar.gz
root@eltex-practice2-pg2-v7:~# ls -lh
total 1.6M
drwxr-xr-x 109 root root 4.0K Oct 19 10:59 etc_backup
-rw-r--r--   1 root root 474K Oct 19 12:27 etc_backup.tar.7z
-rw-r--r--   1 root root 544K Oct 19 12:25 etc_backup.tar.bz2
-rw-r--r--   1 root root 576K Oct 19 12:24 etc_backup.tar.gz



root@eltex-practice2-pg2-v7:~# echo $(date) >> /etc/motd

rsync -av /etc/ /root/etc_backup/
sending incremental file list
./
motd

sent 70,003 bytes  received 286 bytes  140,578.00 bytes/sec
total size is 2,366,813  speedup is 33.67

root@eltex-practice2-pg2-v7:~# tar -rf /root/etc_backup.tar -C / etc/motd

root@eltex-practice2-pg2-v7:~# tar -tjf /root/etc_backup.tar.bz2 | sort > /tmp/archive_files.txt
root@eltex-practice2-pg2-v7:~# find /root/etc_backup/ | sed 's|/root/etc_backup/||' | sort > /tmp/dir_files.txt

root@eltex-practice2-pg2-v7:~# diff -y /tmp/dir_files.txt /tmp/archive_files.txt
xdg/autostart/xdg-user-dirs.desktop                             xdg/autostart/xdg-user-dirs.desktop
xdg/systemd                                                   | xdg/systemd/
xdg/systemd/user                                                xdg/systemd/user
xdg/user-dirs.conf                                              xdg/user-dirs.conf
xdg/user-dirs.defaults                                          xdg/user-dirs.defaults
xml                                                           | xml/
xml/catalog                                                     xml/catalog
xml/catalog.old                                                 xml/catalog.old
xml/polkitd.xml                                                 xml/polkitd.xml
xml/polkitd.xml.old                                             xml/polkitd.xml.old
xml/xml-core.xml                                                xml/xml-core.xml
xml/xml-core.xml.old                                            xml/xml-core.xml.old
zsh_command_not_found                                           zsh_command_not_found

root@eltex-practice2-pg2-v7:~# mkdir -p /root/etc_backup_gzip
root@eltex-practice2-pg2-v7:~# mkdir -p /root/etc_backup_7zip
root@eltex-practice2-pg2-v7:~# tar -xzf /root/etc_backup.tar.gz -C /root/etc_backup_gzip
root@eltex-practice2-pg2-v7:~# 7z x /root/etc_backup.tar.7z -o/tmp/

7-Zip 23.01 (x64) : Copyright (c) 1999-2023 Igor Pavlov : 2023-06-20
 64-bit locale=en_US.UTF-8 Threads:2 OPEN_MAX:1024

Scanning the drive for archives:
1 file, 484712 bytes (474 KiB)

Extracting archive: /root/etc_backup.tar.7z
--
Path = /root/etc_backup.tar.7z
Type = 7z
Physical Size = 484712
Headers Size = 90
Method = LZMA2:24
Solid = -
Blocks = 1

Everything is Ok

Size:       3471360
Compressed: 484712
root@eltex-practice2-pg2-v7:~# tar -xf /tmp/etc_backup.tar -C /root/etc_backup_7zip

root@eltex-practice2-pg2-v7:~# diff -qs /root/etc_backup_gzip/motd /root/etc_backup_7zip/motd
Files /root/etc_backup_gzip/motd and /root/etc_backup_7zip/motd are identical

